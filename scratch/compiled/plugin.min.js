!function(){e=0;var e,a=function(){return"heading-".concat(++e)},t=function(e){for(var t=/<(h[1-8])([^>]*id="([^"]+)"[^>]*)>/gi,n=[];null!==(l=t.exec(e));){var a=l[1],i=parseInt(a.replace(/\D/g,""),10),o=l[3],l=(null==(l=l.input.split(">").pop())?void 0:l.split("<")[0])||"";n.push({tag:a,level:i,text:l,id:o})}return n},c=function(e,t){var a=e.getContent({format:"html"});t.forEach(function(e){var t="h".concat(e.level),n=e.tag,e=e.id,n=new RegExp("(<".concat(n,'[^>]*id="').concat(e,'"[^>]*>)(.*)(</').concat(n,">)"),"gi");a=a.replace(n,"<".concat(t,' id="').concat(e,'">$2</').concat(t,">"))}),e.setContent(a)};function d(e,t){e.notificationManager.open({text:t,type:"error",timeout:3e3})}function g(e,t){void 0===t&&(t=!1);var e=e.getContent({format:"html"}),e=(new DOMParser).parseFromString(e,"text/html"),n=e.querySelectorAll('h1, h2, h3, h4, h5, h6, [role="heading"][aria-level]');return t?{doc:e,all_heading:n}:{all_heading:n}}tinymce.PluginManager.add("headings-test",function(r){r.ui.registry.addButton("headings-test",{text:"Hx",tooltip:"Adjust heading semantic levels",onAction:function(){var e=r.getContent({format:"html"}),o=t(e),l=0,n=function(e){e.setData({level:o[l].level.toString(),headingText:o[l].text,isFirstHeading:0===l,isLastHeading:l===o.length-1})},a=function(e,t){return{title:"Headings",size:"normal",body:{type:"panel",items:[{type:"htmlpanel",html:'<p id="heading-text" style="font-family: Courier Sans;">'.concat(o[l].text,' <span style="font-weight: bold;">(Heading ').concat(l+1," of ").concat(o.length,")</span></p>")},{type:"input",name:"level",inputMode:"numeric",label:"Level",value:o[l].level.toString(),min:1,max:8,placeholder:"Enter heading level"}]},buttons:[{type:"custom",name:"prev",text:"Previous",primary:!1,disabled:e},{type:"custom",name:"next",text:"Next",primary:!1,disabled:t},{type:"cancel",text:"Cancel"},{type:"submit",text:"OK",primary:!0}],initialData:{level:o[l].level.toString(),headingText:o[l].text,isFirstHeading:e,isLastHeading:t},onChange:function(){},onAction:function(e,t){"next"===t.name?l<o.length-1&&(l++,e.redial(a(0===l,l===o.length-1)),n(e)):"prev"===t.name&&0<l&&(l--,e.redial(a(0===l,l===o.length-1)),n(e))},onSubmit:function(e){var t=e.getData(),t=(o[l].level=parseInt(t.level,10),o[l].level),n=g(r).all_heading,a=Array.from(n).map(function(e){return parseInt((e.tagName.match(/h(\d)/i)||[])[1],10)}),i=(a[l]=t,console.log(a),0);n.forEach(function(e){"h1"===e.tagName.toLowerCase()&&i++}),t<1||6<t?d(r,"Choose a heading tag between 1-6"):1===i&&1===t?d(r,"Only one Heading 1 can exist at a time."):!function(e){for(var t=1;t<e.length;t++)if(e[t]<e[t-1])return;return 1}(a)?d(r,"Headings are not in increment order"):c(r,o),e.close()}}},e=r.windowManager.open(a(0===l,l===o.length-1));n(e)}}),r.on("NodeChange",function(){var e=g(r,!0),t=e.doc,e=e.all_heading,n=!1;e.forEach(function(e){e.id||(e.id=a(),n=!0)}),n&&r.undoManager.transact(function(){r.setContent(t.body.innerHTML,{format:"raw"}),r.selection.setCursorLocation(t.body.lastChild,0)})})})}();