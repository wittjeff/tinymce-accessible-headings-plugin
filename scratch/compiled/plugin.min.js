!function(){e=0;var e,a=function(){return"heading-".concat(++e)},t=function(e){for(var t=/<(h[1-8])([^>]*id="([^"]+)"[^>]*)>/gi,n=[];null!==(r=t.exec(e));){var a=r[1],i=parseInt(a.replace(/\D/g,""),10),o=r[3],r=(null==(r=r.input.split(">").pop())?void 0:r.split("<")[0])||"";n.push({tag:a,level:i,text:r,id:o})}return n},s=function(e,t){var a=e.getContent({format:"html"});t.forEach(function(e){var t="h".concat(e.level),n=e.tag,e=e.id,n=new RegExp("(<".concat(n,'[^>]*id="').concat(e,'"[^>]*>)(.*)(</').concat(n,">)"),"gi");a=a.replace(n,"<".concat(t,' id="').concat(e,'">$2</').concat(t,">"))}),e.setContent(a)};tinymce.PluginManager.add("headings-test",function(c){c.ui.registry.addButton("headings-test",{text:"Hx",tooltip:"Adjust heading semantic levels",onAction:function(){var o=c.getContent({format:"html"}),r=t(o),l=0,n=function(e){e.setData({level:r[l].level.toString(),headingText:r[l].text,isFirstHeading:0===l,isLastHeading:l===r.length-1})},a=function(e,t){return{title:"Headings",size:"normal",body:{type:"panel",items:[{type:"htmlpanel",html:'<p id="heading-text" style="font-family: Courier Sans;">'.concat(r[l].text,' <span style="font-weight: bold;">(Heading ').concat(l+1," of ").concat(r.length,")</span></p>")},{type:"input",name:"level",inputMode:"numeric",label:"Level",value:r[l].level.toString(),min:1,max:8,placeholder:"Enter heading level"}]},buttons:[{type:"custom",name:"prev",text:"Previous",primary:!1,disabled:e},{type:"custom",name:"next",text:"Next",primary:!1,disabled:t},{type:"cancel",text:"Cancel"},{type:"submit",text:"OK",primary:!0}],initialData:{level:r[l].level.toString(),headingText:r[l].text,isFirstHeading:e,isLastHeading:t},onChange:function(){},onAction:function(e,t){"next"===t.name?l<r.length-1&&(l++,e.redial(a(0===l,l===r.length-1)),n(e)):"prev"===t.name&&0<l&&(l--,e.redial(a(0===l,l===r.length-1)),n(e))},onSubmit:function(e){var t=e.getData(),t=(r[l].level=parseInt(t.level,10),r[l].level),n=(new DOMParser).parseFromString(o,"text/html").querySelectorAll('h1, h2, h3, h4, h5, h6, [role="heading"][aria-level]'),a=Array.from(n).map(function(e){return parseInt((e.tagName.match(/h(\d)/i)||[])[1],10)}),i=(a[l]=t,console.log(a),0);n.forEach(function(e){"h1"===e.tagName.toLowerCase()&&i++}),1===i&&1===t?c.notificationManager.open({text:"Only one Heading 1 can exist at a time.",type:"error",timeout:3e3}):!function(e){console.log(e);for(var t=1;t<e.length;t++)if(e[t]<e[t-1])return;return 1}(a)?c.notificationManager.open({text:"Headings are not in increment order",type:"error",timeout:3e3}):s(c,r),e.close()}}},e=c.windowManager.open(a(0===l,l===r.length-1));n(e)}}),c.on("NodeChange",function(){var e=c.getContent({format:"html"}),t=(new DOMParser).parseFromString(e,"text/html"),e=t.querySelectorAll('h1, h2, h3, h4, h5, h6, [role="heading"][aria-level]'),n=!1;e.forEach(function(e){e.id||(e.id=a(),n=!0)}),n&&c.undoManager.transact(function(){c.setContent(t.body.innerHTML,{format:"raw"}),c.selection.setCursorLocation(t.body.lastChild,0)})})})}();